# Lifecycle Governance Feature

## Overview

The Lifecycle Governance feature adds lifecycle stage tracking to AI systems, providing soft governance rules and warnings based on the system's current stage in its lifecycle.

## Lifecycle Stages

1. **Draft** - Initial state, no restrictions
2. **Development** - Recommendation to add risk assessments
3. **Testing** - Warning if no approved risk assessments exist
4. **Deployed** - Warning if no approved risk assessments exist
5. **Monitoring** - Allows new assessments, preserves history
6. **Retired** - Read-only view, no new assessments

## Database Changes

### Migration: `add_lifecycle_governance.sql`

Adds:
- `lifecycle_stage` column to:
  - `eu_ai_act_check_results`
  - `mas_ai_risk_assessments`
  - `uk_ai_assessments`
- `lifecycle_history` table for audit trail
- RLS policies for lifecycle history

**Default:** All new systems start with `lifecycle_stage = 'Draft'`

## API Endpoints

### GET `/api/ai-systems/[id]/lifecycle`
Returns:
- Current lifecycle stage
- Lifecycle change history (last 10 changes)

### PUT `/api/ai-systems/[id]/lifecycle`
Updates lifecycle stage and creates audit trail entry.

**Request Body:**
```json
{
  "lifecycle_stage": "Development",
  "change_reason": "Optional reason for change"
}
```

## UI Components

### Dashboard (`/dashboard`)
- Added "Lifecycle" column to unified assessments table
- Shows lifecycle stage badge for each system

### AI System Details Page (`/ai-systems/[id]`)
- **Overview Tab:**
  - Lifecycle stage dropdown (disabled for "Retired")
  - Contextual warnings based on lifecycle stage
  - Links to add/review risk assessments when needed

- **Risk Assessments Tab:**
  - "New Assessment" button hidden for "Retired" systems
  - Warning message shown for retired systems

## Lifecycle Rules (Soft Governance)

### Draft
- ✅ No restrictions
- ✅ Can create/edit risk assessments
- ✅ Can change lifecycle stage

### Development
- ℹ️ **Info:** Recommendation to add risk assessments
- ✅ Can create/edit risk assessments
- ✅ Can change lifecycle stage

### Testing
- ⚠️ **Warning:** No approved risk assessments found (if applicable)
- ✅ Can create/edit risk assessments
- ✅ Can change lifecycle stage

### Deployed
- ⚠️ **Warning:** No approved risk assessments found (if applicable)
- ✅ Can create/edit risk assessments
- ✅ Can change lifecycle stage

### Monitoring
- ℹ️ **Info:** System is in monitoring phase. New assessments can be added.
- ✅ Can create/edit risk assessments
- ✅ Can change lifecycle stage

### Retired
- ℹ️ **Info:** System is retired. View-only mode.
- ❌ Cannot create new risk assessments
- ❌ Cannot change lifecycle stage (dropdown disabled)
- ✅ Can view existing data

## Warning Logic

Warnings are generated by `lib/lifecycle-governance.ts`:
- Checks if approved risk assessments exist
- Checks total risk assessment count
- Returns contextual warnings based on lifecycle stage

## Audit Trail

All lifecycle stage changes are recorded in `lifecycle_history` table:
- `ai_system_id` - System ID
- `previous_stage` - Previous lifecycle stage
- `new_stage` - New lifecycle stage
- `changed_by` - User who made the change
- `changed_at` - Timestamp of change
- `change_reason` - Optional reason for change

## Usage

1. **Run Migration:**
   ```sql
   -- Execute supabase/migrations/add_lifecycle_governance.sql in Supabase SQL Editor
   ```

2. **View Lifecycle Stage:**
   - Dashboard: See lifecycle stage in the "Lifecycle" column
   - System Details: See lifecycle stage in Overview tab

3. **Change Lifecycle Stage:**
   - Go to `/ai-systems/[id]?tab=overview`
   - Use the lifecycle stage dropdown
   - Stage change is saved immediately with audit trail

4. **View Warnings:**
   - Warnings appear automatically in Overview tab
   - Click action buttons to navigate to relevant sections

## Files Modified/Created

### New Files:
- `supabase/migrations/add_lifecycle_governance.sql`
- `app/api/ai-systems/[id]/lifecycle/route.ts`
- `lib/lifecycle-governance.ts`
- `LIFECYCLE_GOVERNANCE_README.md`

### Modified Files:
- `app/dashboard/page.tsx` - Added lifecycle column
- `app/ai-systems/[id]/page.tsx` - Added lifecycle dropdown and warnings
- `app/api/ai-systems/[id]/compliance-data/route.ts` - Include lifecycle_stage

## Notes

- **Soft Governance:** Warnings are informational only, no hard enforcement
- **Backward Compatible:** Existing systems default to "Draft" stage
- **No Breaking Changes:** All existing functionality remains unchanged
- **Audit Trail:** All lifecycle changes are tracked for compliance
